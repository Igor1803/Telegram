# AI-модуль оценки клиентов для Telegram-бота

## Описание

AI-модуль для ведения разговора с клиентами в Telegram и выполнения первичной оценки клиентов. Модуль определяет потребность клиента, временные рамки, объём проекта и наличие БГ (бюджетная готовность), после чего формирует краткий отчёт для передачи руководителю.

## Установка

1. Клонируйте репозиторий или скопируйте файлы проекта

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` на основе `.env.example` и заполните его:
```
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
OPENAI_API_KEY=your_openai_api_key_here
```

4. Получите токен Telegram-бота:
   - Создайте бота через [@BotFather](https://t.me/BotFather)
   - Скопируйте полученный токен в `.env`

5. Получите API ключ OpenAI:
   - Зарегистрируйтесь на [OpenAI Platform](https://platform.openai.com/)
   - Создайте API ключ в разделе API Keys
   - Скопируйте ключ в `.env`

## Запуск

```bash
python bot.py
```

## Структура проекта

- `bot.py` - основной файл Telegram-бота
- `llm_service.py` - сервис для работы с OpenAI API
- `storage.py` - хранилище разговоров (в памяти для MVP)
- `prompts.py` - системный промпт для AI
- `models.py` - модели данных
- `config.py` - конфигурация и загрузка переменных окружения

## Использование

1. Запустите бота командой `python bot.py`
2. Найдите вашего бота в Telegram
3. Отправьте команду `/start` для начала разговора
4. Ведите разговор с ботом - он будет задавать вопросы для оценки
5. Когда разговор завершится, бот сформирует отчёт

## Команды бота

- `/start` - начать новый разговор
- `/reset` - сбросить текущий разговор и начать заново

## Логика принятия решений

### Оценка клиента

AI определяет в процессе разговора:
- **Потребность клиента** - что именно интересует клиента (в свободной формулировке)
- **Временные рамки** - есть ли конкретные сроки реализации (до 12 мес / 24+ мес / нет сроков)
- **Объём проекта** - малый / средний / крупный или неизвестен
- **БГ** - есть ли бюджет и готовность инвестировать (да / нет)

### Приоритизация

- **Приоритет 1**: есть сроки (до 12 мес) И БГ = да
- **Приоритет 2**: интерес есть, но нет сроков и/или БГ
- **Приоритет 3**: нет готовности или сроки 24+ мес

**Важно**: Приоритет 1 запрещён, если БГ = нет.

### Формирование отчёта

После завершения разговора AI формирует структурированный отчёт:
- Потребность клиента
- Временные рамки
- Объём проекта
- БГ (да / нет)
- Рекомендация
- Приоритет (1 / 2 / 3)

## Примеры разговоров

См. файл `examples.md` для примеров разговоров.

## Интеграция

### Интеграция с CRM

Для интеграции с CRM необходимо:

1. Модифицировать `storage.py` для сохранения данных в БД вместо памяти
2. Добавить webhook или API endpoint для получения отчёта
3. Настроить передачу отчёта в CRM после завершения разговора

Пример модификации для сохранения в БД:
```python
# В storage.py добавить методы для работы с БД
def save_report_to_db(self, user_id: int, report: Dict[str, str]):
    # Сохранение в БД
    pass
```

### Интеграция через API

Можно создать REST API endpoint для получения отчёта:
```python
from flask import Flask, jsonify
from storage import ConversationRepository

app = Flask(__name__)
repository = ConversationRepository()

@app.route('/api/report/<int:user_id>')
def get_report(user_id):
    conversation = repository.get_conversation(user_id)
    if conversation and conversation.report:
        return jsonify(conversation.report)
    return jsonify({"error": "Report not found"}), 404
```

## Ограничения MVP

- Хранилище разговоров в памяти (при перезапуске данные теряются)
- Нет интеграции с CRM
- Нет веб-интерфейса для просмотра отчётов
- Нет аналитики и статистики

## Развитие проекта

Возможные улучшения:
- Сохранение разговоров в базу данных (PostgreSQL, MongoDB)
- Интеграция с CRM системами
- Веб-панель для руководителей
- Аналитика и отчёты
- Мультиязычность
- Поддержка голосовых сообщений

